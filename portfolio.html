<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Portfolio — PDF Viewer</title>
  <style>
    :root{
      --bg:#0b0d10; --card:#12161c; --text:#e8eef6; --muted:#9fb0c6; --acc:#69a7ff;
      --maxw:980px; --radius:16px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7f9fc; --card:#ffffff; --text:#0b1220; --muted:#4b5b74; --acc:#2a66ff; }
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
    a{color:#8ec6ff;text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:24px 16px 80px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .title{font-weight:800;font-size:20px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:var(--acc);border:0;color:#fff;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;color:var(--acc);border:2px solid var(--acc)}
    .meta{color:var(--muted);font-size:14px}
    .viewer{background:var(--card);border-radius:var(--radius);padding:14px}
    .page{display:block;margin:0 auto 16px auto;max-width:100%;border-radius:12px;background:#fff}
    .status{margin-top:8px;color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Research & Project Portfolio</div>
        <div class="meta">Scroll through pages below. Zoom works responsively.</div>
      </div>
      <div class="toolbar">
        <button id="zoomOut" class="btn secondary">− Zoom</button>
        <button id="zoomIn" class="btn secondary">+ Zoom</button>
        <a id="download" class="btn" href="#" download>Download PDF</a>
        <a class="btn secondary" href="index.html">← Back</a>
      </div>
    </header>

    <div id="viewer" class="viewer">
      <div id="loading" class="status">Loading PDF…</div>
      <!-- canvases will be appended here -->
    </div>
  </div>

  <!-- pdf.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.5.136/build/pdf.min.js"></script>
  <script>
    // ====== 설정 ======
    // 권장: 리포 안에 assets/portfolio.pdf로 저장 후 아래 경로 사용
    // const PDF_URL = 'https://raw.githubusercontent.com/MichaelKimseongje/Resume/main/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8Cgit.pdf';
    const PDF_URL = 'ProjectContent/Portfoliogit.pdf';
    // 기존 파일명(한글) 그대로 쓰려면 ↓ 이렇게 바꿔도 됩니다.
    // const PDF_URL = '발표자료git.pdf'; // 같은 폴더라면
    // const PDF_URL = '%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8Cgit.pdf'; // URL 인코딩 버전

    // pdf.js 워커 설정
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.5.136/build/pdf.worker.min.js";

    const viewerEl = document.getElementById('viewer');
    const loadingEl = document.getElementById('loading');
    const downloadEl = document.getElementById('download');

    let pdfDoc = null;
    let scale = 1.2;        // 기본 확대 배율
    const minScale = 0.6;
    const maxScale = 2.0;
    const canvases = [];    // 렌더된 페이지 보관

    // PDF 로드
    pdfjsLib.getDocument(PDF_URL).promise.then(async (pdf) => {
      pdfDoc = pdf;
      loadingEl.textContent = `Pages: ${pdfDoc.numPages}`;
      downloadEl.href = PDF_URL;

      for (let p = 1; p <= pdfDoc.numPages; p++) {
        const page = await pdfDoc.getPage(p);
        const canvas = document.createElement('canvas');
        canvas.className = 'page';
        viewerEl.appendChild(canvas);
        canvases.push({canvas, page});
      }
      renderAll();
    }).catch(err => {
      loadingEl.textContent = 'Failed to load PDF. Check file path and CORS.';
      console.error(err);
    });

    function renderAll() {
      loadingEl.textContent = `Rendering…`;
      const promises = canvases.map(({canvas, page}) => {
        const containerWidth = viewerEl.clientWidth - 28; // padding 보정
        // 페이지 너비 기준으로 scale 자동 조정 (가로 너비 맞춤)
        const unscaled = page.getViewport({scale:1});
        const fitScale = Math.min(maxScale, Math.max(minScale, containerWidth / unscaled.width * scale));
        const viewport = page.getViewport({scale: fitScale});
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        const ctx = canvas.getContext('2d');
        return page.render({canvasContext: ctx, viewport}).promise;
      });
      Promise.all(promises).then(() => {
        loadingEl.textContent = `Rendered ${canvases.length} page(s).`;
      });
    }

    // 확대/축소
    document.getElementById('zoomIn').addEventListener('click', () => {
      scale = Math.min(maxScale, scale + 0.1);
      renderAll();
    });
    document.getElementById('zoomOut').addEventListener('click', () => {
      scale = Math.max(minScale, scale - 0.1);
      renderAll();
    });

    // 창 크기 변경 시 재렌더
    let resizeTimer = null;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(renderAll, 200);
    });
  </script>
</body>
</html>
